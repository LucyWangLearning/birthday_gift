<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç»™å¼ æŒ¯å®‡çš„ç”Ÿæ—¥ç¤¼ç‰©</title>
  <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
      font-family: 'ZCOOL KuaiLe', cursive, sans-serif;
      color: #4b2067;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 {
      margin-top: 30px;
      font-size: 2.5em;
      color: #7c3aed;
      text-shadow: 2px 2px 8px #fff6;
      text-align: center;
    }
    #map {
      width: 90vw;
      height: 60vw;
      max-height: 700px;
      margin: 30px auto 0 auto;
      border-radius: 30px;
      box-shadow: 0 8px 32px #7c3aed44;
      overflow: hidden;
      position: relative;
      background: #e0c3fc;
    }
    .star {
      position: absolute;
      width: 36px;
      height: 36px;
      pointer-events: none;
      z-index: 10;
    }
    .tip {
      background: #fff6;
      color: #7c3aed;
      border-radius: 16px;
      padding: 10px 20px;
      font-size: 1.2em;
      margin-top: 10px;
      box-shadow: 0 2px 8px #7c3aed22;
      display: inline-block;
      text-align: center;
      max-width: 90vw;
    }
    .leaflet-container {
      background: transparent !important;
      border-radius: 30px;
    }
    .leaflet-popup-content-wrapper {
      background: #f3e8ff;
      color: #7c3aed;
      border-radius: 16px;
      font-family: 'ZCOOL KuaiLe', cursive, sans-serif;
    }
    .leaflet-popup-tip {
      background: #f3e8ff;
    }
    .leaflet-control-zoom {
      display: none;
    }
    .star-marker { animation: star-bounce 0.7s cubic-bezier(.68,-0.55,.27,1.55); }
    @keyframes star-bounce {
      0% { transform: scale(0.2); opacity: 0; }
      60% { transform: scale(1.2); opacity: 1; }
      80% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }
    .star-svg { filter: drop-shadow(0 2px 6px #ffecb3); }
    .custom-marker { /* ä¸è¦åŠ animationï¼Œé¿å…å½±å“å®šä½ */ }
    @keyframes marker-flip {
      0% { transform: scaleX(1); }
      100% { transform: scaleX(-1); }
    }
    .marker-img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      box-shadow: 0 2px 8px #b39ddb88;
      /* ä¸å†ç”¨animation */
      transition: transform 0.18s cubic-bezier(.68,-0.55,.27,1.55);
    }
    body.marker-anim-sync .marker-img {
      animation-delay: 0s !important;
      animation-play-state: running;
    }
    @media (max-width: 600px) {
      h1, .tip {
        text-align: center !important;
        display: block !important;
        margin-left: auto;
        margin-right: auto;
      }
      .tip {
        font-size: 1.1em;
      }
      #device-tip {
        display: block !important;
      }
      #map {
        margin-top: 60px;
      }
    }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
  <div id="device-tip" style="display:none;background:linear-gradient(90deg,#a18cd1,#fbc2eb);color:#fff;padding:12px 20px;text-align:center;font-size:1em;position:fixed;top:0;left:0;right:0;z-index:10000;box-shadow:0 2px 8px #7c3aed22;">
    ğŸ“± æ¨èä½¿ç”¨PCç«¯è®¿é—®æˆ–æ‰‹æœºæ¨ªå±ä½“éªŒï¼Œæ•ˆæœæ›´ä½³ï¼
  </div>
  <h1>å·å„¿ç»™å¼ æŒ¯å®‡çš„ç”Ÿæ—¥ç¤¼ç‰©çš„ä¸€éƒ¨åˆ†</h1>
  <div id="guide" style="margin:10px 0 0 0;font-size:1.1em;color:#7c3aed;text-align:left;line-height:1.7;font-family:'ZCOOL KuaiLe',cursive,sans-serif;max-width:700px;width:90vw;"></div>
  <div id="map"></div>
  <div class="tip" id="tip">ä½ å°±ç‚¹ç€ç©å„¿å§ï¼Œè¿™ä¸ªpageå¯èƒ½ä¼šæ›´æ–°å§â€¦â€¦</div>
  <div id="celebrate-modal" style="display:none;position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:9999;background:rgba(80,40,120,0.18);backdrop-filter:blur(2px);align-items:center;justify-content:center;">
    <div style="background:rgba(255,255,255,0.98);border-radius:32px;box-shadow:0 8px 32px #7c3aed44;padding:36px 32px 24px 32px;min-width:260px;max-width:90vw;text-align:center;position:relative;">
      <div style="font-size:2.5em;">ğŸ‰ğŸ‚ğŸ¥³ğŸˆâœ¨</div>
      <div style="font-size:1.3em;margin:18px 0 24px 0;color:#7c3aed;">ç¥ä½ ç”Ÿæ—¥å¿«ä¹é¸­ï¼Œè¦ä¸è¦å†ç©å„¿ä¸€æ¬¡ï¼Ÿ</div>
      <button id="restart-btn" style="background:linear-gradient(90deg,#a18cd1,#fbc2eb);color:#fff;font-size:1.1em;padding:10px 36px;border:none;border-radius:20px;box-shadow:0 2px 8px #7c3aed22;cursor:pointer;">å†æ¥ä¸€æ¬¡</button>
    </div>
  </div>
  <div id="location-modal" style="display:none;position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:9998;background:rgba(80,40,120,0.18);backdrop-filter:blur(2px);align-items:center;justify-content:center;">
    <div style="background:rgba(255,255,255,0.98);border-radius:32px;box-shadow:0 8px 32px #7c3aed44;padding:36px 32px 24px 32px;min-width:260px;max-width:90vw;text-align:center;position:relative;">
      <div id="modal-emoji" style="font-size:2.5em;margin-bottom:18px;"></div>
      <div id="modal-content" style="font-size:1.2em;color:#7c3aed;line-height:1.6;"></div>
    </div>
  </div>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // åœ°ç‚¹æ•°æ®
    const locations = [
      { name: 'æˆéƒ½', lat: 30.5728, lng: 104.0668, zoom: 7, area: 1.2 },
      { name: 'æ­å·', lat: 30.2741, lng: 120.1551, zoom: 7, area: 1.2 },
      { name: 'æ–°åŠ å¡', lat: 1.3521, lng: 103.8198, zoom: 9, area: 0.5 },
      { name: 'å¤å¨å¤·', lat: 21.3069, lng: -157.8583, zoom: 8, area: 1.0 },
      { name: 'éŸ©å›½', lat: 37.5665, lng: 126.9780, zoom: 7, area: 1.0 }, // é¦–å°”
      { name: 'ç™½ä¿„ç½—æ–¯', lat: 53.9006, lng: 27.5590, zoom: 6, area: 2.5 }, // æ˜æ–¯å…‹
      { name: 'å¾·å›½', lat: 51.1657, lng: 10.4515, zoom: 5, area: 2.5 },
    ];
    let step = 0; // å½“å‰æ­¥éª¤ï¼Œåˆå§‹ä¸º0ï¼Œç¬¬ä¸€æ­¥åˆ¤å®šæˆéƒ½
    let stars = [];
    let guessedLatLngs = [];
    let polyline = null;

    // å¼•å¯¼ç›¸å…³çŠ¶æ€
    let guideStep = 0; // 0: ä¸æ˜¾ç¤ºï¼Œ1: åªæ˜¾ç¤ºç¬¬ä¸€è¡Œï¼Œ2: æ˜¾ç¤ºå‰ä¸¤è¡Œï¼Œ3: æ˜¾ç¤ºä¸‰è¡Œ
    let errorCount = 0; // æˆéƒ½å‰é”™è¯¯è®¡æ•°
    let errorCountAfterChengdu = 0; // æˆéƒ½åé”™è¯¯è®¡æ•°
    let errorCountAfterHangzhou = 0; // æ­å·åé”™è¯¯è®¡æ•°

    // åœ°ç‚¹å¼¹çª—é…ç½®åˆ—è¡¨ - ä½ å¯ä»¥ä¿®æ”¹è¿™é‡Œçš„emojiå’Œå†…å®¹
    const locationMessages = [
      {
        name: 'æˆéƒ½',
        emoji: 'ğŸŒ¶ï¸ğŸ¼',
        content: 'å¥½å§ï¼Œæ¢¦å¼€å§‹çš„åœ°æ–¹ï¼ä½ ä¹Ÿæ¥è¿‡å‘¨è¾¹å¾·é˜³å•¥çš„ï¼Œæˆ‘ä¹Ÿå°±ç®—ä¸€èµ·å•¦ï¼ˆæ¯•ç«Ÿç›¸è¾ƒäºå…¶ä»–åœ°ç†å°ºåº¦â€¦â€¦'
      },
      {
        name: 'æ­å·',
        emoji: 'ğŸŒŠğŸµ',
        content: 'è¿˜è®°å¾—å½“å¹´è¥¿äº¤é¸½ä½ ï¼é˜¿æµ™è¿™ä¸å¥½å¤šäº†ï¼<br><br>æ—¶é—´æˆ³ï¼š2022.09.28'
      },
      {
        name: 'æ–°åŠ å¡',
        emoji: 'ğŸŒ´ğŸŒ´',
        content: 'æœ‰å€’éœ‰è›‹æŠŠæŠ¤ç…§ä¸¢åœ¨è¿™é‡Œå•¦ï¼<br><br>æ—¶é—´æˆ³ï¼š2024.05.08'
      },
      {
        name: 'å¤å¨å¤·',
        emoji: 'ğŸŒºğŸ–ï¸',
        content: 'å¤å¨å¤·ï¼ç«å±±ï¼å¤§æµ·ï¼ISMRMï¼<br><br>æ—¶é—´æˆ³ï¼š2025.05.10'
      },
      {
        name: 'éŸ©å›½',
        emoji: 'ğŸœğŸœ',
        content: 'è°¢è°¢å“¥ç»™æˆ‘å¸¦çš„å·´é»è´ç”œï¼è™½ç„¶åœç•™çš„æ—¶é—´å¾ˆçŸ­ä½†æ˜¯ç»™ä½ ç®—ä¸Šäº†ï¼<br><br>æ—¶é—´æˆ³ï¼š2024.05.16'
      },
      {
        name: 'ç™½ä¿„ç½—æ–¯',
        emoji: 'ğŸŒ²ğŸ°',
        content: 'è™½ç„¶è¿˜æ²¡å‘ç”Ÿä½†æ˜¯ä¹Ÿå†™ä¸Šå†™ä¸Šï¼ç™½ä¿„ç½—æ–¯å›½ç«‹å¤§å­¦ï¼<br><br>æ—¶é—´æˆ³ï¼š2025.07'
      },
      {
        name: 'å¾·å›½',
        emoji: 'ğŸºğŸ›ï¸',
        content: 'å¾·å›½çš„å•¤é…’å’ŒåŸå ¡ï¼æ…•å°¼é»‘å·¥ä¸šå¤§å­¦ï¼<br><br>æ—¶é—´æˆ³ï¼š2025.07'
      }
    ];
    
    // åˆå§‹åŒ–åœ°å›¾ï¼Œæ˜¾ç¤ºæˆéƒ½å’Œæ­å·
    const map = L.map('map', {
      center: [30.4, 112],
      zoom: 5,
      zoomControl: false,
      attributionControl: false,
      minZoom: 2,
      maxZoom: 10,
      maxBounds: [[-85, -180], [85, 180]],
      dragging: false, // åˆå§‹ç¦æ­¢æ‹–åŠ¨
      scrollWheelZoom: false, // åˆå§‹ç¦æ­¢æ»šè½®ç¼©æ”¾
      doubleClickZoom: false, // åˆå§‹ç¦æ­¢åŒå‡»ç¼©æ”¾
      boxZoom: false, // åˆå§‹ç¦æ­¢æ¡†é€‰ç¼©æ”¾
      keyboard: false // åˆå§‹ç¦æ­¢é”®ç›˜ç¼©æ”¾
    });
    L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
      minZoom: 2,
      maxZoom: 19,
    }).addTo(map);

    // marker.jpgå›¾ç‰‡Leaflet markerå›¾æ ‡ï¼ˆåŒæ­¥åŠ¨ç”»ï¼‰
    const markerIcon = L.divIcon({
      className: 'custom-marker',
      iconSize: [32, 32],
      iconAnchor: [16, 16],
      html: `<img src="marker.jpg" class="marker-img" width="32" height="32" draggable="false"/>`
    });

    // æ˜¾ç¤ºmarkerå›¾ç‰‡
    function showStar(lat, lng) {
      // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è¯¥ç‚¹çš„marker
      if (stars.some(s => s.lat === lat && s.lng === lng)) return;
      const marker = L.marker([lat, lng], { icon: markerIcon, interactive: false, keyboard: false, zIndexOffset: 1000 }).addTo(map);
      stars.push({ marker, lat, lng });
    }

    // è¿çº¿
    function updatePolyline() {
      if (polyline) {
        map.removeLayer(polyline);
      }
      if (guessedLatLngs.length > 1) {
        polyline = L.polyline(guessedLatLngs, { color: '#FFD600', weight: 4, dashArray: '6 8', lineCap: 'round' }).addTo(map);
      }
    }

    // æ­¥éª¤æç¤º
    function setTip() {
      document.getElementById('tip').innerText = 'ä½ å°±ç‚¹ç€ç©å„¿å§ï¼Œè¿™ä¸ªpageå¯èƒ½ä¼šæ›´æ–°å§â€¦â€¦';
    }

    // åˆ¤å®šåŒºåŸŸ
    function isInArea(lat, lng, target, area) {
      // æ–°åŠ å¡ç‰¹æ®Šåˆ¤å®šï¼šæ–°åŠ å¡æˆ–é©¬æ¥è¥¿äºšéƒ½ç®—
      if (target.name === 'æ–°åŠ å¡') {
        // æ–°åŠ å¡å¤§è‡´èŒƒå›´
        const sgBounds = {
          north: 1.48, south: 1.20, west: 103.6, east: 104.1
        };
        // é©¬æ¥è¥¿äºšå¤§è‡´èŒƒå›´
        const myBounds = {
          north: 7.5, south: 0.8, west: 99.6, east: 119.3
        };
        if (
          lat >= sgBounds.south && lat <= sgBounds.north &&
          lng >= sgBounds.west && lng <= sgBounds.east
        ) return true;
        if (
          lat >= myBounds.south && lat <= myBounds.north &&
          lng >= myBounds.west && lng <= myBounds.east
        ) return true;
      }
      // éŸ©å›½ç‰¹æ®Šåˆ¤å®šï¼šæ•´ä¸ªéŸ©å›½åŒºåŸŸéƒ½ç®—
      if (target.name === 'éŸ©å›½') {
        // éŸ©å›½å¤§è‡´èŒƒå›´
        const krBounds = {
          north: 38.7, south: 33.0, west: 124.5, east: 131.9
        };
        if (
          lat >= krBounds.south && lat <= krBounds.north &&
          lng >= krBounds.west && lng <= krBounds.east
        ) return true;
      }
      // å¤å¨å¤·ç‰¹æ®Šåˆ¤å®šï¼šå››å¤§å²›éƒ½ç®—
      if (target.name === 'å¤å¨å¤·') {
        // å››å¤§å²›ç»çº¬åº¦èŒƒå›´ï¼ˆå¤§è‡´ï¼‰
        const islands = [
          // æ¬§èƒ¡å²›
          { north: 21.72, south: 21.20, west: -158.3, east: -157.6 },
          // æ¯›ä¼Šå²›
          { north: 21.05, south: 20.60, west: -156.8, east: -156.2 },
          // å¤å¨å¤·å¤§å²›
          { north: 20.30, south: 18.80, west: -156.1, east: -154.7 },
          // è€ƒè‰¾å²›
          { north: 22.30, south: 21.80, west: -159.8, east: -159.3 },
        ];
        for (const isl of islands) {
          if (
            lat >= isl.south && lat <= isl.north &&
            lng >= isl.west && lng <= isl.east
          ) return true;
        }
      }
      // å…¶ä»–åœ°ç‚¹æŒ‰åŸæœ‰é€»è¾‘
      const R = 6371; // åœ°çƒåŠå¾„km
      const dLat = (lat - target.lat) * Math.PI / 180;
      const dLng = (lng - target.lng) * Math.PI / 180;
      const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat * Math.PI / 180) * Math.cos(target.lat * Math.PI / 180) *
                Math.sin(dLng/2) * Math.sin(dLng/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      const d = R * c;
      // åˆ¤å®šèŒƒå›´éšæ­¥æ•°é€’å¢å˜å¤§
      return d < area * (1 + step * 0.8) * 50;
    }

    // æ­¥éª¤æµç¨‹
    function nextStep() {
      if (step < locations.length) {
        const points = locations.slice(0, step + 1).map(loc => [loc.lat, loc.lng]);
        let bounds = L.latLngBounds(points);
        let duration = 2.2; // ç»Ÿä¸€è°ƒæ…¢
        // ç§»åŠ¨ç«¯è°ƒæ•´padding
        const isMobile = window.innerWidth <= 600;
        const padding = isMobile ? [80, 80] : [140, 140];
        
        if (step === 1) {
          const pad = 4;
          bounds = L.latLngBounds([
            [Math.min(points[0][0], points[1][0]) - pad, Math.min(points[0][1], points[1][1]) - pad],
            [Math.max(points[0][0], points[1][0]) + pad, Math.max(points[0][1], points[1][1]) + pad]
          ]);
        }
        map.fitBounds(bounds, { animate: true, padding, duration });
        map.once('moveend', () => {
          setTimeout(() => {
            updatePolyline();
            setTip(); // ç¼©æ”¾åŠ¨ç”»ç»“æŸåå†æ˜¾ç¤ºtip
          }, 400);
        });
      } else {
        setTip();
        const isMobile = window.innerWidth <= 600;
        const finalPadding = isMobile ? [20, 20] : [30, 30];
        map.fitBounds([[-60, -170], [75, 180]], { animate: true, padding: finalPadding, duration: 2.2 });
        map.once('moveend', () => {
          setTimeout(() => {
            updatePolyline();
            // æ˜¾ç¤ºåº†ç¥å¼¹çª—
            document.getElementById('celebrate-modal').style.display = 'flex';
            setTip();
          }, 400);
        });
      }
    }

    // åˆå§‹ç¼©æ”¾åˆ°æˆéƒ½åŒºåŸŸ
    // ç”¨æˆéƒ½ä¸ºä¸­å¿ƒæ˜¾ç¤ºå‘¨è¾¹
    map.setView([locations[0].lat, locations[0].lng], 8); // æˆéƒ½å‘¨è¾¹
    setTimeout(() => {
      setTip();
    }, 800);

    // é‡ç½®æ¸¸æˆçŠ¶æ€
    function resetGame() {
      // ç§»é™¤æ‰€æœ‰marker
      stars.forEach(({ marker }) => marker.remove());
      stars = [];
      // ç§»é™¤è¿çº¿
      if (polyline) { map.removeLayer(polyline); polyline = null; }
      guessedLatLngs = [];
      step = 0;
      // æ¢å¤åœ°å›¾åˆ°æˆéƒ½å‘¨è¾¹
      map.setView([locations[0].lat, locations[0].lng], 8);
      setTip();
      // ç¦æ­¢ç¼©æ”¾æ‹–åŠ¨
      map.dragging.disable();
      map.scrollWheelZoom.disable();
      map.doubleClickZoom.disable();
      map.boxZoom.disable();
      map.keyboard.disable();
      // éšè—å¼¹çª—
      document.getElementById('celebrate-modal').style.display = 'none';
      document.getElementById('location-modal').style.display = 'none';
      guideStep = 0;
      errorCount = 0;
      errorCountAfterChengdu = 0;
      errorCountAfterHangzhou = 0;
      updateGuide();
    }

    // æ˜¾ç¤ºåœ°ç‚¹å¼¹çª—
    function showLocationModal(locationName) {
      const location = locationMessages.find(loc => loc.name === locationName);
      if (location) {
        document.getElementById('modal-emoji').innerText = location.emoji;
        document.getElementById('modal-content').innerHTML = location.content;
        document.getElementById('location-modal').style.display = 'flex';
        
        // 3ç§’åè‡ªåŠ¨éšè—
        setTimeout(() => {
          document.getElementById('location-modal').style.display = 'none';
        }, 3000);
      }
    }

    // ç‚¹å‡»äº‹ä»¶
    map.on('click', function(e) {
      if (step >= locations.length) return;
      const loc = locations[step];
      if (isInArea(e.latlng.lat, e.latlng.lng, loc, loc.area)) {
        showStar(loc.lat, loc.lng);
        guessedLatLngs.push([loc.lat, loc.lng]);
        updatePolyline();
        
        // æ˜¾ç¤ºåœ°ç‚¹å¼¹çª—
        showLocationModal(loc.name);
        
        if (step === 0) {
          map.options.dragging = true;
          map.options.scrollWheelZoom = true;
          map.options.doubleClickZoom = true;
          map.options.boxZoom = true;
          map.options.keyboard = true;
          map.dragging.enable();
          map.scrollWheelZoom.enable();
          map.doubleClickZoom.enable();
          map.boxZoom.enable();
          map.keyboard.enable();
          // æˆéƒ½è¢«ç‚¹å¯¹åï¼Œé‡ç½®æˆéƒ½åé˜¶æ®µé”™è¯¯è®¡æ•°
          errorCountAfterChengdu = 0;
        }
        if (step === 1) {
          // æ­å·è¢«ç‚¹å¯¹åï¼Œé‡ç½®æ­å·åé˜¶æ®µé”™è¯¯è®¡æ•°
          errorCountAfterHangzhou = 0;
        }
        step++;
        updateGuide();
        nextStep();
      } else {
        if (step === 0) {
          errorCount++;
          if (errorCount >= 3 && guideStep < 1) {
            guideStep = 1;
            updateGuide();
          }
          alert('ç‚¹é”™å•¦ï¼è¯·å†è¯•ä¸€æ¬¡~');
        } else if (step === 1) {
          errorCountAfterChengdu++;
          if (errorCountAfterChengdu >= 3 && guideStep < 2) {
            guideStep = 2;
            updateGuide();
          }
          alert('ç‚¹é”™å•¦ï¼è¯·å†è¯•ä¸€æ¬¡~');
        } else if (step === 2) {
          errorCountAfterHangzhou++;
          if (errorCountAfterHangzhou >= 3 && guideStep < 3) {
            guideStep = 3;
            updateGuide();
          }
          alert('å•Šæˆ‘è¿˜ä¸çŸ¥é“ä½ å»è¿‡è¿™ä¸ªåœ°æ–¹ï¼Œä½ ç»™æˆ‘æissueæˆ‘æ”¹ã€‚');
        } else {
          errorCountAfterHangzhou++;
          if (errorCountAfterHangzhou >= 3 && guideStep < 3) {
            guideStep = 3;
            updateGuide();
          }
          if (guideStep >= 3) {
            alert('å“¥ä»¬å„¿ä½ å»è¿‡è¿™ä¹ˆå¤šåœ°æ–¹å—ï¼ä½ å¾€ä½ å‘Šè¯‰è¿‡æˆ‘çš„è¡Œç¨‹ç‚¹â€¦â€¦');
          } else {
            alert('å•Šæˆ‘è¿˜ä¸çŸ¥é“ä½ å»è¿‡è¿™ä¸ªåœ°æ–¹ï¼Œä½ ç»™æˆ‘æissueæˆ‘æ”¹ã€‚');
          }
        }
      }
    });

    // é¡µé¢åŠ è½½åç”¨JSå®šæ—¶å™¨åŒæ­¥æ‰€æœ‰marker-imgçš„transformï¼Œå®ç°å·¦å³ç¿»è½¬åŠ¨ç”»
    let markerFlipTimerStarted = false;
    function syncMarkerFlip() {
      if (markerFlipTimerStarted) return;
      markerFlipTimerStarted = true;
      let flipped = false;
      setInterval(() => {
        flipped = !flipped;
        document.querySelectorAll('.marker-img').forEach(img => {
          img.style.transform = flipped ? 'scaleX(-1)' : 'scaleX(1)';
        });
      }, 500);
    }
    document.addEventListener('DOMContentLoaded', syncMarkerFlip);

    // é¡µé¢åˆå§‹æ—¶ç¡®ä¿å¼¹çª—éšè—ã€markeråŠ¨ç”»åŒæ­¥ã€æŒ‰é’®ç»‘å®š
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('celebrate-modal').style.display = 'none';
      syncMarkerFlip();
      document.getElementById('restart-btn').onclick = function() {
        resetGame();
        // è‡ªåŠ¨æ»šåŠ¨åˆ°åœ°å›¾åŒºåŸŸ
        document.getElementById('map').scrollIntoView({ behavior: 'smooth', block: 'center' });
      };
    });

    function updateGuide() {
      let html = '';
      if (guideStep >= 1) {
        html += '1.ä½ å…ˆç‚¹æˆéƒ½ï¼Œæˆéƒ½æ˜¯å¼€å§‹çš„åœ°æ–¹ã€‚<br>';
      }
      if (guideStep >= 2) {
        html += '2.å¥½å§ï¼Œç¬¬äºŒä¸ªåœ°æ–¹æ˜¯æ­å·ã€‚æç¤ºï¼šä»æ­¤å¾€åçš„åˆ¤å®šåŒºåŸŸèŒƒå›´æ‰©å¤§è‡³çœ/å›½ã€‚<br>';
      }
      if (guideStep >= 3) {
        html += '3.å“¥ä»¬å„¿ä½ å»è¿‡è¿™ä¹ˆå¤šåœ°æ–¹å—ï¼ä½ å¾€ä½ å‘Šè¯‰è¿‡æˆ‘çš„è¡Œç¨‹ç‚¹â€¦â€¦';
      }
      document.getElementById('guide').innerHTML = html;
      document.getElementById('guide').style.display = guideStep === 0 ? 'none' : '';
    }
    updateGuide();
  </script>
</body>
</html> 
<!-- 
    å¥½å§åœ¨è¿™é‡Œå†™ç‚¹ç¢ç¢å¿µï¼Œä»£è¡¨äº†æˆ–è®¸æˆ‘å¸Œæœ›ä½ çœ‹è§ï¼Œåˆä¸å¸Œæœ›ä½ çœ‹è§çš„å¿ƒæƒ…ã€‚å¦‚æœçœ‹è§äº†ï¼Œé‚£æˆ‘ä¹Ÿç®—ä¼ è¾¾åˆ°äº†è¿™ä¸€éƒ¨åˆ†çš„å¿ƒæ„ã€‚æ²¡çœ‹è§ä¹Ÿæ— æ‰€è°“ã€‚
    ï¼ˆæ‰€ä»¥æœ€å¥½ä½ å°±åˆ«çœ‹è§äº†ï¼Œæˆ‘æ€»è§‰å¾—æˆ‘å¥½åƒå¾ˆçˆ±è¡¨è¾¾å¿ƒæ„â€¦â€¦æˆ‘éƒ½æ€•ä½ å«Œçƒ¦â€¦â€¦ä¸€æ¬¡ä¸¤æ¬¡ä¸‰æ¬¡å•Šå•Šå•Šå¯¹ä¸èµ·ï¼æˆ‘å¤ªä¸æ”¾å¼ƒäº†â€¦â€¦
    ï¼ˆä½†æ˜¯æ— æ‰€è°“æˆ‘å°±è¦å†™æˆ‘å°±è¦è¯´ï¼Œå¯æ¶æ˜¨å¤©åœ¨æ¸¸æˆé‡Œé‚€ä½ ä½ éƒ½ä¸ç†æˆ‘ï¼Œå¥½å§å¦‚æœè¿™æ®µå…³ç³»ä¼šèµ°å‘å°½å¤´é‚£æˆ‘ä¹Ÿç®—åŠªåŠ›è¿‡äº†â€¦â€¦å•Šå•Šå•Šå•Šå•Šå•Šå•Šâ€¦â€¦ç®—äº†æ— æ‰€è°“
    æˆ‘å…¶å®ä¸çŸ¥é“ä½ æ˜¯å¦ä¼šå‘ç°é æ•ä¸Šçš„nfcï¼Œæ˜¯å¦ä¼šæ‰«ï¼Œæ˜¯å¦ä¼šåœ¨ç”Ÿæ—¥å½“å¤©æ‰“å¼€è¿™ä¸ªç½‘é¡µã€‚æœ‰å¤ªå¤šçš„ä¸ç¡®å®šæ€§ã€‚å°±åƒæˆ‘çŒœä¸é€ä½ æ˜¯å¦å¯¹æˆ‘æœ‰å¥½æ„Ÿã€‚
    ç®—äº†ï¼Œä½ ç”Ÿæ—¥å½“å¤©å†é—®ä¸€ä¸‹å§ã€‚ä½ ä¸ç¢°æˆ‘å°±ç›´æ¥ç»™ä½ å‘ç½‘å€ï¼Œæ¯•ç«Ÿæˆ‘åšéƒ½åšäº†ï¼Œä½ å¿…é¡»ç»™æˆ‘çœ‹è§ï¼ï¼ï¼æ€¥æ€¥æ€¥

    å·²ç»å–œæ¬¢ä½ å¾ˆä¹…äº†ï¼ä»è¿™ä¸ªç½‘é¡µä¹Ÿå¯ä»¥çœ‹å‡ºæ¥æ—¶é—´è·¨åº¦ä¹Ÿè›®ä¹…çš„ã€‚
    æƒ³èµ·æ¥å¥½åƒç¬¬ä¸€æ¬¡è§ä½ æ˜¯åœ¨ç½—ä½³çš„è¡Œæ”¿è¯¾ä¸Šï¼Œå¥¹è¯´ä½ é’¢ç´åçº§ï¼å¯ä»¥ä¸€èµ·ç©å„¿ä¹é˜Ÿä»€ä¹ˆçš„ï¼Ÿä¸è¿‡å½“æ—¶å“ˆå“ˆå“ˆä¿ºä»¬æä¹é˜Ÿä¹Ÿæå¾—å¾ˆèœå°±æ˜¯äº†ã€‚ï¼ˆä¹é˜Ÿå’Œå¤å…¸ä¹Ÿå¾ˆä¸ä¸€æ ·å•Šâ€¦â€¦
    é‚£ä¸ªæ—¶å€™å®Œå…¨æ²¡æƒ³åˆ°åé¢ä¼šè¿™ä¹ˆå–œæ¬¢ä½ ã€‚
    ä¹‹åçš„äº¤é›†å°±æ˜¯æœ¬ç§‘æœ«å‡ å¹´æ—¶å€™çš„å„ç§äº¤é›†ï¼Œå¥½åƒä¹Ÿä¸ç®—å¤šå§ï¼Œä½†æ˜¯ä½ å°±æ˜¯ç‰¹åˆ«ç‰¹åˆ«ç‰¹åˆ«å¸å¼•æˆ‘ã€‚ï¼ˆå¯èƒ½å› ä¸ºå¤§å®¶å½“æ—¶éƒ½ç©å„¿æ˜æ—¥æ–¹èˆŸï¼ŸåŠ ä¸Šä½ åˆå¥½ä¼˜ç§€å“ˆå“ˆå“ˆï¼
    å½“æ—¶æ—çš„å„ç§åˆ†ç»„å•Šä»€ä¹ˆæŠ½è±¡æ“ä½œå•Šå•¥çš„ï¼Œæˆ–è€…æ˜¯è¯·ä½ å¸®å¿™æ‹¿ä¹¦ä»€ä¹ˆçš„ã€‚å¥½åƒå°±æ˜¯åœ¨ä¸€äº›å¾ˆçç¢çš„äº‹æƒ…ä¸­å’Œä½ æœ‰ä¸€äº›æ¥è§¦ã€‚
    åæ¥ä¼šå’Œä½ èŠä¸€äº›åˆ«çš„ï¼Œæ„Ÿè§‰ä½ è®²è¯ä¹Ÿå¥½å¯çˆ±ï¼ŒåˆæŠ€æœ¯åŠ›æ‹‰æ»¡åˆå¾ˆæœ‰æ„æ€ã€‚å°±é€æ¸å¥½å–œæ¬¢ä½ ã€‚è®°ä¸å¤ªæ¸…äº†ï¼Œå¤ªä¹…äº†â€¦â€¦
    â€¦â€¦å›æƒ³èµ·æ¥ï¼Œå¥½æ€€å¿µå½“æ—¶æœ¬ç§‘çš„æ—¶å€™ã€‚åœ¨è¿™ç§æ¯•ä¸šå­£ã€‚åœ¨èº«è¾¹çš„äººéƒ½é€æ¸ç¦»å»ï¼Œä¿ºä¹Ÿæ­¥å…¥ç¡•å£«æœ€åä¸€å¹´çš„å€’è®¡æ—¶çš„æ—¶å€™ã€‚

    ä½†æ˜¯ä½ å¥½ä¸ä¸€æ ·ï¼å»é˜¿æµ™ä¹‹åæ„Ÿè§‰æœ‰å¥½å¤šæœºä¼šå¯ä»¥å»å„ç§å„æ ·çš„åœ°æ–¹ï¼è¿˜å¾—æ˜¯ä½ æµ™é˜¿ï¼ï¼ï¼è€Œä¸”ä¹Ÿè¿˜å¾—æ˜¯å“¥ä¼˜ç§€å•Šï¼ï¼ï¼
    å¦ˆå‘€å“¥è¿™ä¹ˆä¼˜ç§€æ„Ÿè§‰è‚¯å®šä¸€äº¿ä¸ªäººå–œæ¬¢â€¦â€¦
    å“¦æ‰€ä»¥æˆ‘ä¹Ÿè§‰å¾—ä½ çœ‹ä¸åˆ°ä¹Ÿæ— æ‰€è°“ï¼Œè¿™æ®µå–œæ¬¢ä½ çš„ç»å†å¯¹æˆ‘æ¥è¯´å°±æ˜¯ï¼Œèƒ½å¤Ÿçœ‹åˆ°ä½ é—ªé—ªå‘å…‰ï¼Œç„¶åæˆ‘èƒ½å¤Ÿæœ‰å‹‡æ°”å»ï¼Œå’’éª‚ä¸€äº›è¯¥å’’éª‚çš„ï¼Œå¥”å‘ä¸€äº›è¯¥å¥”å‘çš„ã€‚
    ä¹Ÿèƒ½åœ¨å’Œä½ åæ§½çš„è¿‡ç¨‹ä¸­å¾—åˆ°ä½ çš„æ”¯æŒä½ çš„åŠ›é‡ã€‚
    æƒ³ç€ï¼Œæˆ‘è¶…å–œæ¬¢çš„å“¥ï¼è¿™ä¹ˆç‰›é€¼ï¼Œæˆ‘ä¹Ÿæƒ³è¦å˜å¾—æ›´å¼ºï¼Œæˆ–è®¸æœ‰æœä¸€æ—¥èƒ½å¤Ÿç«™åœ¨ä»–èº«è¾¹ã€‚
    æˆ‘å…¶å®å¾ˆç¾¡æ…•ä½ ï¼Œå¯ä»¥æœ‰é‚£ä¹ˆå¤šæœºä¼šå»ä¸ä¸€æ ·çš„åœ°æ–¹ã€‚çœŸå¥½çœŸå¥½ï¼
    æ„Ÿè§‰è¿™å°±è¶³å¤Ÿäº†ã€‚

    æ‰€ä»¥ä¹‹å‰å’Œä½ è¡¨è¾¾æˆ‘è¶…å–œæ¬¢ä½ çš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰å¥¢æ±‚ä¸€å®šå¸Œæœ›å“¥å’Œæˆ‘åœ¨ä¸€èµ·å•¥çš„ã€‚è¿™æ¬¡ä¹Ÿä¸ä¼šçš„ã€‚æˆ‘å¸Œæœ›ä½ èƒ½å¤Ÿè‡ªç”±ï¼Œè¶…çº§è‡ªç”±åœ°ï¼ç©å„¿äººç”Ÿçš„æ¸¸æˆã€‚
    ï¼ˆè™½ç„¶ä¿ºä¹Ÿä¼šæœ‰æœŸå¾…å°±æ˜¯äº†â€¦â€¦ä¹Ÿæœ‰ä¸€äº›å†…è€—å•¥çš„ï¼Œä¸è¿‡æ— æ‰€è°“ï¼Œæˆ‘ä¹Ÿä¼šå¹³è¡¡å¥½æˆ‘çš„æœŸå¾…å’Œæˆ‘çš„ç”Ÿæ´»ã€‚
    ä¸è¿‡å¥½åƒï¼Œæˆ‘å…¶å®å¯¹ä½ ä¹Ÿæ²¡æœ‰ç‰¹åˆ«äº†è§£ã€‚å’Œä½ èŠå¤©çš„æ—¶å€™ï¼Œå¥½åƒç»å¸¸æ˜¯æˆ‘åœ¨è¡¨è¾¾æ¬¸ã€‚æ‰€ä»¥æ—¶å¸¸æ„Ÿè°¢ä½ æ„¿æ„å¬æˆ‘è®²ä¸€äº›æœ‰çš„æ²¡çš„å“ˆå“ˆï¼Œå¥½å‘†ã€‚
    è¦æ˜¯ä½ ä¹Ÿå¯ä»¥ï¼Œå’Œæˆ‘åˆ†äº«ä¸€äº›ä½ çš„ç”Ÿæ´»ï¼Œæˆ–è€…++ç¨å¾®ä¾é æˆ‘ä¸€ä¸‹ï¼Œæˆ‘ä¹Ÿä¼šå¾ˆå¼€å¿ƒçš„ï¼
    ä¸çŸ¥é“ä½ å¯¹æ‰¾å¯¹è±¡æ€ä¹ˆæ‰“ç®—çš„ï¼Œä½†æ˜¯å¦‚æœè¦æ‰¾ï¼Œé‚£æˆ‘æŠ•æˆ‘ä¸€ç¥¨ã€‚å¦‚æœä¸æ‰¾ï¼Œé‚£æˆ‘æƒ³è¦æˆ‘ä»¬èƒ½ä¸€ç›´å½“å¥½æœ‹å‹ï¼å“ˆå“ˆï¼Œä¸è¿‡å¦‚æœä½ è§‰å¾—æœ‰è´Ÿæ‹…ï¼Œå—¯å¦‚æœè¦æ‹‰é»‘çš„è¯ï¼Œèƒ½ä¸èƒ½å‘Šè¯‰æˆ‘ä¸€ä¸‹å†æ‹‰é»‘â€¦â€¦

    å¥½å•¦å¥½å•¦ï¼Œå›åˆ°ä¸»é¢˜å§ï¼Œç”Ÿæ—¥å¿«ä¹å‘€ï¼
    å“¥ä¹‹åçš„æ—¥å­ä¸€å®šä¹Ÿä¼šè¶…çº§é¡ºåˆ©ã€‚è¿‡ä¸Šè‡ªå·±æƒ³è¦çš„ç”Ÿæ´»ã€‚
    ï¼ˆå¥½å¥½å¥½éƒ½å†™åˆ°è¿™äº†ï¼Œä½ è€è¯´çœ‹æˆ‘ä»¥åæƒ³è¦ä»€ä¹ˆæ ·çš„ç”Ÿæ´»æ¥åˆ¤æ–­ç°åœ¨æ‰¾ä»€ä¹ˆå·¥ä½œï¼æˆ‘ä¸çŸ¥é“å•Šï¼æƒ³å’Œä½ ä¸€èµ·ç®—ä¸ç®—ï¼Ÿé‚£ä½ æƒ³è¦å•¥æ ·çš„ç”Ÿæ´»å•Š
    å“ˆå“ˆï¼Œå°±æ˜¯å¸Œæœ›ä½ çœ‹åˆ°è¿™ä¸ªç½‘é¡µä¹Ÿä¼šå¼€å¿ƒå°±å¥½äº†ï¼
    ç„¶åä¸è¦æœ‰å‹åŠ›ï¼Œä¸è¦æœ‰è´Ÿæ‹…ï¼Œä¸è¦æœ‰å†…è€—ï¼Œä¸è¦æœ‰ç„¦è™‘ï¼Œä¸è¦æœ‰è´Ÿé¢æƒ…ç»ªã€‚
    
    å¼ æŒ¯å®‡ï¼Œç¥ä½ ç”Ÿæ—¥å¿«ä¹ï¼
-->
